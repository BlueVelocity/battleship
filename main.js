(()=>{"use strict";const t=function(){function t(t){if("string"==typeof t)this.elem=document.createElement(t);else{if(!t.nodeName)throw new Error("InputError: Argument must be string or Element");this.elem=t}}return t.prototype.appendChildren=function(){for(var t=this,e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];e.forEach((function(e){return t.elem.appendChild(e.elem)}))},t.prototype.appendClassList=function(t){var e=this;t.split(" ").forEach((function(t){e.elem.classList.add(t)}))},t.prototype.removeFromClassList=function(t){var e=this;t.split(" ").forEach((function(t){e.elem.classList.remove(t)}))},t.prototype.replaceClassList=function(t){var e=this;this.elem.classList.forEach((function(t){e.elem.classList.remove(t)})),this.appendClassList(t)},t.prototype.hide=function(){this.elem.classList.contains("hidden")||this.appendClassList("hidden")},t.prototype.show=function(){this.removeFromClassList("hidden")},t.prototype.invisible=function(){this.elem.classList.contains("opacity-0")||this.appendClassList("opacity-0")},t.prototype.visible=function(){this.removeFromClassList("opacity-0")},t.prototype.fade=function(){this.elem.classList.contains("opacity-30")||this.appendClassList("opacity-30")},t.prototype.unFade=function(){this.removeFromClassList("opacity-30")},t.prototype.fadeSoft=function(){this.elem.classList.contains("opacity-60")||this.appendClassList("opacity-60")},t.prototype.unFadeSoft=function(){this.removeFromClassList("opacity-60")},t.prototype.clearChildren=function(){for(;this.elem.lastElementChild;)this.elem.removeChild(this.elem.lastElementChild)},t}();var e,o=(e=function(t,o){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},e(t,o)},function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)});const n=function(e){function n(o){var n=e.call(this,"div")||this;n.elem.id="header",n.appendClassList("grid min-h-12 flex-1 items-center bg-red-500");var r=new t("span");return r.appendClassList("items-center text-center text-xl"),r.elem.textContent=o,n.elem.appendChild(r.elem),n}return o(n,e),n}(t);var r=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();const i=function(t){function e(){var e=t.call(this,"div")||this;return e.elem.id="game-area",e.appendClassList("m-10 grid w-2/3 grid-cols-[repeat(auto-fit,minmax(14rem,1fr))] grid-rows-1 items-center gap-10 self-center"),e}return r(e,t),e}(t);var a=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();const s=function(t){function e(){var e=t.call(this,"div")||this;return e.elem.id="util-area",e.appendClassList("flex flex-col items-center"),e}return a(e,t),e}(t);var l=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();const c=function(e){function o(o){var r=e.call(this,"div")||this;return r.shipCount=0,r.errorMessage=new t("p"),r.placeShipText=new t("span"),r.rotateButton=new t("button"),r.shipButtonArea=new t("div"),r.startButton=new t("button"),r.elem.id="ship-placement-tools",r.appendClassList("flex flex-col items-center"),r.errorMessage.elem.id="ship-placement-error",r.errorMessage.elem.textContent="Error Message :^)",r.errorMessage.invisible(),r.errorMessage.appendClassList("text-red-500"),r.placeShipText.elem.textContent="Place your ships!",r.placeShipText.appendClassList("mb-1"),r.shipButtons=n.createShipButtons([["Destroyer","2"],["Submarine","3"],["Cruiser","3"],["Battleship","4"],["Carrier","5"]]),r.shipButtons.forEach((function(t){t.elem.addEventListener("click",(function(){o.placeShipReq(Number(r.getCurrentSelected().elem.getAttribute("data-ship-length")),(function(){return r.placed()}),(function(t){return r.displayError(t)}))})),r.shipButtonArea.appendChildren(t)})),r.rotateButton.appendClassList(n.styles.unselected+" mb-2"),r.rotateButton.elem.textContent="ROTATE",n.toggleRotateButton(r.rotateButton),r.shipButtonArea.appendClassList(n.styles.buttonArea),r.startButton.appendClassList(n.styles.startButton),r.startButton.elem.textContent="START!",r.startButton.hide(),r.appendChildren(r.errorMessage,r.placeShipText,r.rotateButton,r.shipButtonArea,r.startButton),r}var n;return l(o,e),o.getOrientation=function(){return this.orientation},o.prototype.getCurrentSelected=function(){return this.shipButtons.find((function(t){return t.elem.classList.contains(n.styles.selected)}))},o.prototype.placed=function(){var t=this.getCurrentSelected();if(t.removeFromClassList(n.styles.selected),t.appendClassList(n.styles.placed),t.fade(),this.shipCount++,this.shipCount>=n.maxShips){for(;this.elem.childElementCount>1;)this.elem.removeChild(this.elem.firstElementChild);this.startButton.show()}},o.prototype.displayError=function(t){var e=this;this.errorMessage.visible(),this.errorMessage.elem.textContent=t.message,setTimeout((function(){return e.errorMessage.invisible()}),5e3)},o.prototype.assignToStart=function(t){var e=this;this.startButton.elem.addEventListener("click",(function(){e.elem.parentNode.removeChild(e.elem.parentNode.firstElementChild),t()}))},n=o,o.orientation=1,o.maxShips=5,o.styles={unselected:"text-sm border border-black py-0.5 px-1 m-0.5 rounded transition duration-250 linear active:scale-105",selected:"bg-orange-500",placed:"pointer-events-none bg-gray-500",buttonArea:"flex-1 grid-cols-[repeat(auto-fit,minmax(14rem,1fr))] grid-rows-1 place-content-center",startButton:"text-lg border border-black py-0.5 px-1 m-1 rounded transition duration-250 linear active:scale-105 bg-green-500"},o.addActiveButtonToggle=function(t){t.forEach((function(e){e.elem.addEventListener("click",(function(){t.forEach((function(t){return t.elem.classList.remove(n.styles.selected)})),e.appendClassList(n.styles.selected)}))}))},o.toggleRotateButton=function(t){t.elem.addEventListener("click",(function(){t.elem.classList.contains(n.styles.selected)?(n.orientation=1,t.removeFromClassList(n.styles.selected)):(n.orientation=2,t.appendClassList(n.styles.selected))}))},o.createShipButtons=function(e){var o=e.map((function(e){var o=new t("button");return o.appendClassList(n.styles.unselected),o.elem.textContent=e[0]+" - "+e[1],o.elem.setAttribute("data-ship-length",e[1]),o}));return n.addActiveButtonToggle(o),o},o}(t);var u=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();const d=function(e){function o(n,r){var i=e.call(this,"div")||this;i.appendClassList(o.styles.winnerScreen);var a=new t("p");a.elem.textContent=n+" is the winner!";var s=new t("button");return s.appendClassList(o.styles.button),s.elem.textContent="RESTART",s.elem.addEventListener("click",(function(){return r()})),i.appendChildren(a,s),i}return u(o,e),o.styles={button:"text-lg border border-black py-0.5 px-1 m-0.5 rounded transition duration-250 linear active:scale-105",winnerScreen:"flex flex-col items-center"},o}(t);var p=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();const f=function(e){function o(t){var o=e.call(this,"div")||this;return o.tiles=[],o.name=t,o.appendClassList("flex aspect-square h-full flex-col bg-blue-500"),o}return p(o,e),o.getTileCoordinate=function(t){return t.getAttribute("data-coord").split(",").map((function(t){return Number(t)}))},o.prototype.load=function(e,n,r){var i=this;void 0===n&&(n=!1),void 0===r&&(r=!1),this.clearChildren(),e.forEach((function(a,s){var l=new t("div");l.appendClassList("flex-auto flex"),a.forEach((function(a,c){var u=new t("div");u.elem.setAttribute("data-coord","".concat(c,",").concat(s)),i.tiles.push(u.elem),1===e[c][s]&&!1===n?u.appendClassList(o.styles.tileShip):2===e[c][s]?u.appendClassList(o.styles.tileHit):3===e[c][s]?u.appendClassList(o.styles.tileMiss):4===e[c][s]?u.appendClassList(o.styles.tileSunk):!0===r?u.appendClassList(o.styles.tileEmptySelect):u.appendClassList(o.styles.tileEmptyNoSelect),l.elem.appendChild(u.elem)})),i.elem.appendChild(l.elem)}));var a=new t("span");a.appendClassList("relative bg-sky-200"),a.elem.textContent=this.name[0].toUpperCase()+this.name.slice(1),this.elem.appendChild(a.elem)},Object.defineProperty(o.prototype,"domTiles",{get:function(){return this.tiles},enumerable:!1,configurable:!0}),o.styles={tileEmptySelect:"flex-auto border border-black bg-blue-500 hover:cursor-pointer active:outline-red-500 active:outline-4 active:outline active:z-50 active:rounded hover:bg-blue-700",tileEmptyNoSelect:"flex-auto border border-black bg-blue-500",tileShip:"flex-auto border border-black bg-orange-500",tileHit:"flex-auto border border-black bg-red-500",tileMiss:"flex-auto border border-black bg-gray-500",tileSunk:"flex-auto border border-black bg-red-900"},o}(t),h=function(){function t(t){this.length=t,this.hits=0}return t.prototype.hit=function(){this.hits++},t.prototype.isSunk=function(){return this.length===this.hits},t}(),m=function(){function t(){var e=this;this.shipLengths=[5,4,3,3,2],this.place=function(t,o,n,r){void 0===r&&(r=1);var i=new h(t);e.validatePlacement(t,o,n,r).forEach((function(t){return e.boardModel[t[0]][t[1]]=i}))},this.receiveAttack=function(t,o){if(1===e.missed[t][o]||1===e.hits[t][o])throw new Error("SelectionError: Target already selected");var n=e.boardModel[t][o];null!==n?(n.hit(),e.hits[t][o]=1):e.missed[t][o]=1},this.allSunk=function(){var t=!0;return e.boardModel.forEach((function(e){e.forEach((function(e){null!==e&&!1===e.isSunk()&&(t=!1)}))})),t},this.boardModel=t.createGrid(),this.missed=t.createGrid(),this.hits=t.createGrid()}return t.createGrid=function(){for(var e=[],o=0;o<t.defaultSize;o++){e.push([]);for(var n=0;n<t.defaultSize;n++)e[o].push(null)}return e},t.prototype.validatePlacement=function(e,o,n,r){for(var i=[],a=0;a<e;a++)if(1===r){if(n+a>=t.defaultSize||o>=t.defaultSize)throw new Error("PlacementError: Out of bounds");if(this.boardModel[o][n+a]instanceof h)throw new Error("PlacementError: Collides with existing ship");i.push([o,n+a])}else{if(2!==r)throw new Error("InputError: Invalid orientation");if(o+a>=t.defaultSize||n>=t.defaultSize)throw new Error("PlacementError: Out of bounds");if(this.boardModel[o+a][n]instanceof h)throw new Error("PlacementError: Collides with existing ship");i.push([o+a,n])}return i},t.prototype.autoPlace=function(){for(var e in this.shipLengths)for(var o=!1;!1===o;){var n=Math.round(2*Math.random()+1),r=void 0,i=void 0;try{1===n?(r=Math.round((t.defaultSize-1)*Math.random()),i=Math.round((t.defaultSize-1-length)*Math.random())):(r=Math.round((t.defaultSize-1-length)*Math.random()),i=Math.round((t.defaultSize-1)*Math.random())),this.place(this.shipLengths[e],r,i,n),o=!0}catch(t){}}},Object.defineProperty(t.prototype,"board",{get:function(){var e=this,o=t.createGrid();return this.boardModel.forEach((function(t,n){t.forEach((function(t,r){null!==e.boardModel[n][r]&&e.boardModel[n][r].isSunk()?o[n][r]=4:null!==e.hits[n][r]?o[n][r]=2:null!==e.boardModel[n][r]?o[n][r]=1:null!==e.missed[n][r]&&(o[n][r]=3)}))})),o},enumerable:!1,configurable:!0}),t.defaultSize=10,t}(),y=function(){function t(t,e){this.previousSelections=[],this.gameBoard=new m,this.computer=e,this.name=t}return t.prototype.autoAttackSelection=function(){var t,e=m.defaultSize,o=[Math.round(Math.random()*(e-1)),Math.round(Math.random()*(e-1))],n=o[0],r=o[1];if(this.previousSelections.length>0)for(;this.previousSelections.some((function(t){var e=t[0],o=t[1];if(e===n&&o===r)return!0}));)t=[Math.round(Math.random()*(e-1)),Math.round(Math.random()*(e-1))],n=t[0],r=t[1];return this.previousSelections.push([n,r]),[n,r]},t}(),v=function(){function t(t,e){var o=this;this.previousSelections=[],this.placeShipReq=function(t,e,n){o.boardComponent.load(o.model.gameBoard.board,!1,!0),o.boardComponent.domTiles.forEach((function(r){var i=function(){var a=f.getTileCoordinate(r),s=a[0],l=a[1],u=c.getOrientation();try{o.model.gameBoard.place(t,s,l,u),o.boardComponent.load(o.model.gameBoard.board,!1,!0),e()}catch(t){r.removeEventListener("click",i,!1),n(t)}};r.addEventListener("click",i)}))},this.model=new y(t,e),this.boardComponent=new f(t)}return t.prototype.reset=function(t,e){this.model=new y(this.model.name,this.model.computer),this.boardComponent=new f(this.boardComponent.name),this.loadBoard(t,e)},t.prototype.loadBoard=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1),this.boardComponent.load(this.model.gameBoard.board,e,t)},t.prototype.assignTileCallback=function(t){this.boardComponent.domTiles.forEach((function(e){return e.addEventListener("click",(function(){return t()}))}))},t.prototype.attackLoop=function(t,e){var o=this;if(!1===t.model.computer)this.boardComponent.domTiles.forEach((function(n){n.classList.value===f.styles.tileEmptySelect&&n.addEventListener("click",(function(){try{var r=n.getAttribute("data-coord").split(",").map((function(t){return Number(t)})),i=r[0],a=r[1];o.model.gameBoard.receiveAttack(i,a),o.loadBoard(!0,!0)}catch(t){console.error(t)}o.model.gameBoard.allSunk()?e(t):t.model.gameBoard.allSunk()?e(o):t.attackLoop(o,e)}))}));else{var n=t.model.autoAttackSelection(),r=n[0],i=n[1];this.boardComponent.unFadeSoft(),t.boardComponent.fadeSoft(),setTimeout((function(){o.model.gameBoard.receiveAttack(r,i),o.loadBoard(!1,!1)}),1e3),setTimeout((function(){o.boardComponent.fadeSoft(),t.boardComponent.unFadeSoft(),o.model.gameBoard.allSunk()?e(t):t.model.gameBoard.allSunk()?e(o):t.attackLoop(o,e)}),2e3)}},t}();var b=document.querySelector("body"),C=new t(b),g=new n("BATTLESHIP"),w=new i,S=new s;C.appendChildren(g,w,S);var L=new v("Player",!1);L.loadBoard(!0);var E=new v("Computer",!0);E.loadBoard(!1,!0),E.boardComponent.fade(),w.appendChildren(L.boardComponent,E.boardComponent);var x=new c(L);function B(){L.loadBoard(!1,!1),L.model.computer&&L.model.gameBoard.autoPlace(),E.model.computer&&E.model.gameBoard.autoPlace(),E.boardComponent.unFade(),L.boardComponent.fadeSoft(),E.loadBoard(!0,!0),E.attackLoop(L,M)}function _(){L.reset(!0,!1),L.boardComponent.unFadeSoft(),E.reset(!1,!0),E.boardComponent.fade(),w.clearChildren(),L.loadBoard(!0,!1),E.loadBoard(!1,!0),w.appendChildren(L.boardComponent,E.boardComponent),S.clearChildren(),(x=new c(L)).assignToStart((function(){return B()})),c.orientation=1,S.appendChildren(x)}function M(t){S.appendChildren(new d(t.model.name,_))}S.appendChildren(x),x.assignToStart((function(){return B()}))})();